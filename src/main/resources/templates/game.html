<!DOCTYPE html>
<html lang="pl"
      xmlns:th="https://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout}">

<head>
    <title th:text="|${game.title} - GameZone|">GameZone</title>
</head>

<body>
<div class="container">
    <main class="main-content" layout:fragment="content">
        <div class="margin-box">

            <section class="game ">

                <div class="game-container">

                    <div class="game-rating-container-top ">
                            <h3 class="game-rating-heading">ocena gry</h3>
                        <div>
                            <p class="game-rating-value" th:if="${game.ratingCount ge minVotesToDisplay}"
                               th:text="${game.averageRating}">7.3
                            <p class="game-rating-heading" th:if="${game.ratingCount lt minVotesToDisplay}">za mało głosów</p>
                            <p class="game-rating-heading" th:if="${game.ratingCount lt minVotesToDisplay}"
                            th:text="|minimum to: ${minVotesToDisplay}|">minimum to</p>
                            <p class="game-rating-count" th:text="|oceny:
                            ${#numbers.formatDecimal(game.ratingCount, 0, 'WHITESPACE', 0, 'POINT')}|">212 ocen</p>
                            </p>
                        </div>
                    </div>
                    <div class="rating-buttons-container">
                        <button type="button" class="form-back-button" id="show-stats">
                            <i class="fa-solid fa-chart-simple rate-stats"></i>
                        </button>
                    </div>
                    <div class="game-summary">
                        <div class="summary-cover-wrapper">
                            <img src="../static/img/notfound.jpg"
                                 th:src="${game.poster ne null} ? @{|/galeria/gry/${game.poster}|} : @{/galeria/gry/game-poster-placeholder.jpg}"
                                 th:alt="${game.title}"
                                 alt="tytuł gry"
                                 class="game-summary-cover"
                            />
                        </div>
                    </div>
                    <div class="game-rating-container game-section">
                        <h3 class="game-rating-heading">twoja ocena</h3>

                        <div sec:authorize="isAuthenticated()">
                            <p id="user-rate" class="game-rating-value-user"
                               th:text="${userRate ne null ? userRate:'?'}">?</p>

                            <p id="user-rate-message" class="game-rating-message"></p>
                        </div>
                        <form action="#" th:action="@{/ocen-gre}" method="post" sec:authorize="isAuthenticated()">
                            <div class="rating-slider-container">
                                <input type="hidden" name="gameId" th:value="${game.id}">
                                <input name="rating" id="slider" type="range" min="0" max="10" step="0.5"
                                       class="rating-slider" th:value="${userRate}">
                                <button id="game-rate-button" type="submit" class="game-rate-button">oceń</button>
                            </div>
                        </form>
                        <p class="game-rating-login" sec:authorize="isAnonymous()">
                            <a href="/zaloguj" th:href="@{/zaloguj}">Zaloguj sie</a>, aby zagłosować
                        </p>

                    </div>
                </div>


                <div class="game-summary-info">
                    <div class="platforms-container hide-platforms">
                        <ul class="platform-list">
                            <li class="platform_element" th:each="platform: ${game.platform}">
                                <a class="platform-item" href="#"
                                   th:href="@{|/gry/platforma/${platform.key}|}">
                                    <div class="icon-container">
                                        <span th:utext="${platform.value}" class="platform-logo"></span>
                                        <span class="platform-text" th:text="${platform.key}">Pc</span>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <h1 class="game-summary-title" th:text="${game.title}">Mass Effect 3</h1>
                    <p class="game-summary-short-description" th:text="${game.shortDescription}">
                        Trzecia odsłona osadzonej w konwencji space opery gry studia BioWare.
                        Mass Effect 3 jest zwieńczeniem epickiej trylogii opowiadającej o losach komandora Sheparda
                        i konflikcie z prastarą rasą Żniwiarzy.
                    </p>

                    <div class="game-summary-details">
                        <ul class="game-summary-item game-summary-category" th:if="${game.category}">
                            <li th:each="gameCategory : ${game.category}">
                                <a href="#"
                                   th:if="${!game.category.isEmpty()}"
                                   th:href="@{|/gry/kategorie/${gameCategory.name}|}"
                                   th:text="${gameCategory.name}">RPG</a>
                            </li>
                        </ul>

                        <ul class="game-summary-item">
                            <li>
                                <span>Tryb gry:</span>
                                <a th:each="mode:${game.gameModes}">
                                    <i th:if="${mode.name} eq 'singleplayer'" title="singleplayer"
                                       class="fa-solid fa-user"></i>
                                    <i th:if="${mode.name} eq 'multiplayer'" title="multiplayer"
                                       class="fa-solid fa-users">
                                <span class="game-summary-item-gamemode"
                                      th:if="${game.playerRange.maxPlayers} ge ${game.playerRange.minPlayers}"
                                      th:text="|${game.playerRange.minPlayers} - ${game.playerRange.maxPlayers}|">1</span>
                                    </i>
                                </a>
                                <i th:if="${game.gameModes.isEmpty()}" title="brak" class="fa-solid fa-question"></i>
                            </li>

                        </ul>
                        <div class="game-producers">
                            <span class="game-summary-item">producent:
                        <a href="#"
                           th:href="@{|/katalog-firm/firma/${#strings.replace(game.producer.name,' ','-')}/${game.producer.id}|}"
                           th:text="${game.producer.name}">BioWare
                        </a>
                    </span>
                            <span class="game-summary-item">wydawca:
                        <a href="#"
                           th:href="@{|/katalog-firm/firma/${#strings.replace(game.publisher.name,' ','-')}/${game.publisher.id}|}"
                           th:text="${game.publisher.name}">Electronic Arts Inc.
                        </a>
                    </span>
                        </div>
                    </div>
                    <ul class="game-summary-date-box-list">
                        <li th:each="date:${gameReleaseDates}">
                            <div class="game-summary-date-box">
                                <ul class="game-summary-platform-name-list">
                                    <li th:if="${date.key.year le 3000} or ${date.key.year} eq 8888 or ${date.key.year} eq 9999"
                                        th:each="platform:${date.value}"
                                        th:text="${platform}">PC
                                    </li>

                                </ul>
                                <ul th:if="${date.key.year le 3000} or ${date.key.year} eq 8888 or ${date.key.year} eq 9999"
                                    class="game-summary-platform-date-list">
                                    <li th:if="${date.key.year le 3000}" class="date-day"
                                        th:text="${#temporals.format(date.key, 'd')}"></li>
                                    <li th:if="${date.key.year le 3000}" class="date-month"
                                        th:text="${#temporals.format(date.key, 'MMM')}"></li>
                                    <li th:if="${date.key.year le 3000}" class="date-year"
                                        th:text="${#temporals.format(date.key, 'yyyy')}"></li>
                                    <li th:if="${date.key.year eq 8888}" class="date-year">nieznana</li>
                                    <li th:if="${date.key.year eq 9999}" class="date-year">anulowana</li>
                                </ul>
                            </div>

                    </ul>
                    <div class="date-mobile-box">
                        <p class="game-summary-item release-date-hidden" th:each="date:${gameReleaseDates}">
                            <span th:if="${date.key.year le 3000}" th:text="${date.value}">Platforma</span>
                            <span class="date-text" th:if="${date.key.year le 3000}"
                                  th:text="${#temporals.format(date.key, 'd MMM yyyy')}">Date</span>

                            <span th:if="${date.key.year eq 8888}" th:text="${date.value}">Platforma</span>
                            <span class="date-text" th:if="${date.key.year eq 8888}">nieznana</span>

                            <span th:if="${date.key.year eq 9999}" th:text="${date.value}">Platforma</span>
                            <span class="date-text" th:if="${date.key.year eq 9999}">anulowana</span>
                        </p>
                    </div>
                </div>

                <div class="rate-stats-sticky hide-stats-container" id="rate-stats-sticky">
                    <div class="rate-stats-container hide-stats-container" id="stats-container">
                        <button class="rate-stats-close">
                            <i class="fa-solid fa-x" id="close-rates"></i>
                        </button>

                        <div class="rate-stats-header">
                            <p>Oceny użytkowników</p>
                        </div>
                        <div class="rate-stats-border"></div>

                        <div class="rate-subheader-container">
                            <div class="rate-subheader">
                                <i class="fa-solid fa-star"></i>
                                <p class="rate-stats-rate" th:if="${game.ratingCount ge 2}"
                                   th:text="${game.averageRating}">7.3</p>
                                <p  class="rate-message" th:if="${game.ratingCount lt 2}">za mało ocen</p>
                            </div>

                            <div class="rate-count">
                                <p th:text="${#numbers.formatDecimal(game.ratingCount, 0, 'WHITESPACE', 0, 'POINT')}">
                                    323</p>
                                <p th:if="${game.ratingCount eq 1}">ocena</p>
                                <p th:if="${game.ratingCount gt 1} and ${game.ratingCount lt 5}">oceny</p>
                                <p th:if="${game.ratingCount ge 5 or game.ratingCount eq 0} ">ocen</p>
                            </div>
                        </div>

                        <div class="rate-stats-border"></div>

                        <div class="rate-details-container">
                            <div class="rate-container" th:each="i:${#numbers.sequence(0,20)}">
                                <div class="rate-value-box">
                                    <i class="fa-solid fa-star"></i>
                                    <p th:if="${(i/2.0 lt 10.0) and (i/2.0 gt 0.0)}" th:text="${i/2.0}"></p>
                                    <p th:if="${i/2.0} eq 10.0">10</p>
                                    <p th:if="${i/2.0} eq 0.0">0</p>
                                </div>

                                <div class="rate-load-box">
                                    <span class="rate-load-bar"
                                          th:style="'width: ' + ${allRates[(i/2.0)] !=null ? allRates[(i/2.0)]:0} + '%'">
                                    </span>
                                </div>

                                <div class="rate-details-count">
                                    <p th:if="${allRates[(i/2.0)] gt 1 or allRates[(i/2.0)] le 0}"
                                       th:text="|${#numbers.formatDecimal(allRates[(i/2.0)] != null ? allRates[(i/2.0)] : 0,1,0,'POINT')}%|">%</p>

                                    <p th:if="${allRates[(i/2.0)] gt 0 and allRates[(i/2.0)] lt 1}"
                                       th:text="|${#numbers.formatDecimal(allRates[(i/2.0)] != null ? allRates[(i/2.0)] : 0,1,1,'POINT')}%|">%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </section>

            <div class="platforms-container show-platforms">
                <ul class="platform-list">
                    <li class="platform_element" th:each="platform: ${game.platform}">
                        <a class="platform-item" href="#"
                           th:href="@{|/gry/platforma/${platform.key}|}">
                            <div class="icon-container">
                                <span th:utext="${platform.value}" class="platform-logo"></span>
                                <span class="platform-text" th:text="${platform.key}">Pc</span>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="game-full-description">
                <section class="game-section">
                    <section th:utext="${game.description}"></section>
                </section>
                <section class="game-trailer">
                    <h2 class="article-heading">Zwiastun</h2>

                    <script class="game-trailer" src="https://geo.dailymotion.com/player/xr9tu.js"
                            th:data-video="${game.dailymotionTrailerId}"></script>
                </section>
            </div>
        </div>
        <script src="/static/scripts/company.js" th:src="@{/scripts/gameRaiting.js}"></script>
    </main>
</div>
</body>
</html>